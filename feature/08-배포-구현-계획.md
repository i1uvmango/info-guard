# ë°°í¬ êµ¬í˜„ ê³„íš

## ğŸ¯ **ë°°í¬ êµ¬í˜„ ê°œìš”**
Info-Guard í”„ë¡œì íŠ¸ì˜ ë°°í¬ëŠ” Docker ì»¨í…Œì´ë„ˆí™”, CI/CD íŒŒì´í”„ë¼ì¸, ê·¸ë¦¬ê³  í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •ì„ í¬í•¨í•©ë‹ˆë‹¤. ê°œë°œ í™˜ê²½ì—ì„œ í”„ë¡œë•ì…˜ í™˜ê²½ê¹Œì§€ ì›í™œí•œ ë°°í¬ë¥¼ ìœ„í•œ ìë™í™” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

## ğŸ—ï¸ **ë°°í¬ ì•„í‚¤í…ì²˜**

### 1. ì „ì²´ ë°°í¬ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo   â”‚    â”‚  GitHub Actions â”‚    â”‚   Docker Hub    â”‚
â”‚   (Source Code) â”‚â”€â”€â”€â–ºâ”‚   (CI/CD)       â”‚â”€â”€â”€â–ºâ”‚   (Registry)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Local Dev     â”‚    â”‚   Staging       â”‚    â”‚   Production    â”‚
â”‚   Environment   â”‚    â”‚   Environment   â”‚    â”‚   Environment   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. í™˜ê²½ë³„ êµ¬ì„±
- **ê°œë°œ í™˜ê²½ (Development)**: ë¡œì»¬ ê°œë°œìš©
- **ìŠ¤í…Œì´ì§• í™˜ê²½ (Staging)**: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ìš©
- **í”„ë¡œë•ì…˜ í™˜ê²½ (Production)**: ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ìš©

## ğŸ³ **Docker ì»¨í…Œì´ë„ˆí™”**

### 1. Python ì„œë²„ Dockerfile
```dockerfile
# êµ¬í˜„ ìœ„ì¹˜: src/python-server/Dockerfile

FROM python:3.11-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë° í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„± íŒŒì¼ ë³µì‚¬ ë° ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY . .

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

# í—¬ìŠ¤ì²´í¬ ì¶”ê°€
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/api/v1/health || exit 1

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 2. Node.js ì„œë²„ Dockerfile
```dockerfile
# êµ¬í˜„ ìœ„ì¹˜: src/nodejs-server/Dockerfile

FROM node:18-alpine

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# package.json ë° package-lock.json ë³µì‚¬
COPY package*.json ./

# ì˜ì¡´ì„± ì„¤ì¹˜
RUN npm ci --only=production

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY . .

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 3000

# í—¬ìŠ¤ì²´í¬ ì¶”ê°€
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:3000/api/v1/health || exit 1

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
CMD ["npm", "start"]
```

### 3. Docker Compose ì„¤ì •
```yaml
# êµ¬í˜„ ìœ„ì¹˜: docker-compose.yml

version: '3.8'

services:
  # PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
  postgres:
    image: postgres:15-alpine
    container_name: infoguard-postgres
    environment:
      POSTGRES_DB: infoguard
      POSTGRES_USER: infoguard_user
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"
    networks:
      - infoguard-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U infoguard_user -d infoguard"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Redis ìºì‹œ
  redis:
    image: redis:7-alpine
    container_name: infoguard-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - infoguard-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Python AI ì„œë²„
  python-server:
    build:
      context: ./src/python-server
      dockerfile: Dockerfile
    container_name: infoguard-python-server
    environment:
      - DATABASE_URL=postgresql://infoguard_user:${POSTGRES_PASSWORD}@postgres:5432/infoguard
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - infoguard-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Node.js ë°±ì—”ë“œ ì„œë²„
  nodejs-server:
    build:
      context: ./src/nodejs-server
      dockerfile: Dockerfile
    container_name: infoguard-nodejs-server
    environment:
      - DATABASE_URL=postgresql://infoguard_user:${POSTGRES_PASSWORD}@postgres:5432/infoguard
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - PYTHON_SERVER_URL=http://python-server:8000
    ports:
      - "3000:3000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      python-server:
        condition: service_healthy
    networks:
      - infoguard-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
  nginx:
    image: nginx:alpine
    container_name: infoguard-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - python-server
      - nodejs-server
    networks:
      - infoguard-network

volumes:
  postgres_data:
  redis_data:

networks:
  infoguard-network:
    driver: bridge
```

## ğŸš€ **CI/CD íŒŒì´í”„ë¼ì¸**

### 1. GitHub Actions ì›Œí¬í”Œë¡œìš°
```yaml
# êµ¬í˜„ ìœ„ì¹˜: .github/workflows/deploy.yml

name: Deploy to Production

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œ
  test-and-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install Python dependencies
      run: |
        cd src/python-server
        pip install -r requirements-dev.txt
    
    - name: Run Python tests
      run: |
        cd src/python-server
        python -m pytest tests/ -v --cov=app
    
    - name: Install Node.js dependencies
      run: |
        cd src/nodejs-server
        npm ci
    
    - name: Run Node.js tests
      run: |
        cd src/nodejs-server
        npm test
    
    - name: Build Docker images
      run: |
        docker build -t infoguard-python:latest src/python-server/
        docker build -t infoguard-nodejs:latest src/nodejs-server/
    
    - name: Run integration tests
      run: |
        docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit

  # ìŠ¤í…Œì´ì§• ë°°í¬
  deploy-staging:
    needs: test-and-build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Deploy to staging
      run: |
        echo "ìŠ¤í…Œì´ì§• í™˜ê²½ì— ë°°í¬ ì¤‘..."
        # ìŠ¤í…Œì´ì§• ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

  # í”„ë¡œë•ì…˜ ë°°í¬
  deploy-production:
    needs: [test-and-build, deploy-staging]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    environment: production
    
    steps:
    - name: Deploy to production
      run: |
        echo "í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬ ì¤‘..."
        # í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```

### 2. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# êµ¬í˜„ ìœ„ì¹˜: scripts/deploy.sh

set -e

ENVIRONMENT=$1
VERSION=$2

if [ -z "$ENVIRONMENT" ] || [ -z "$VERSION" ]; then
    echo "ì‚¬ìš©ë²•: ./deploy.sh <environment> <version>"
    echo "ì˜ˆì‹œ: ./deploy.sh production v1.0.0"
    exit 1
fi

echo "ğŸš€ $ENVIRONMENT í™˜ê²½ì— $VERSION ë²„ì „ì„ ë°°í¬í•©ë‹ˆë‹¤..."

# í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ ë¡œë“œ
source .env.$ENVIRONMENT

# Docker ì´ë¯¸ì§€ íƒœê·¸
docker tag infoguard-python:latest infoguard-python:$VERSION
docker tag infoguard-nodejs:latest infoguard-nodejs:$VERSION

# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì œê±°
docker-compose -f docker-compose.$ENVIRONMENT.yml down

# ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose -f docker-compose.$ENVIRONMENT.yml up -d

# í—¬ìŠ¤ì²´í¬ ëŒ€ê¸°
echo "ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ì¤‘..."
sleep 30

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
if docker-compose -f docker-compose.$ENVIRONMENT.yml ps | grep -q "Up"; then
    echo "âœ… $ENVIRONMENT í™˜ê²½ ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
else
    echo "âŒ ë°°í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
    exit 1
fi
```

## ğŸŒ **í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •**

### 1. Nginx ì„¤ì •
```nginx
# êµ¬í˜„ ìœ„ì¹˜: nginx/nginx.conf

events {
    worker_connections 1024;
}

http {
    upstream python_backend {
        server python-server:8000;
    }
    
    upstream nodejs_backend {
        server nodejs-server:3000;
    }
    
    # Gzip ì••ì¶•
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # ë³´ì•ˆ í—¤ë”
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    server {
        listen 80;
        server_name infoguard.example.com;
        
        # HTTPë¥¼ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        return 301 https://$server_name$request_uri;
    }
    
    server {
        listen 443 ssl http2;
        server_name infoguard.example.com;
        
        # SSL ì¸ì¦ì„œ ì„¤ì •
        ssl_certificate /etc/nginx/ssl/cert.pem;
        ssl_certificate_key /etc/nginx/ssl/key.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        
        # Python AI ì„œë²„ API
        location /api/v1/analysis/ {
            proxy_pass http://python_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # Node.js ë°±ì—”ë“œ API
        location /api/v1/ {
            proxy_pass http://nodejs_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # WebSocket ì—°ê²°
        location /ws/ {
            proxy_pass http://python_backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # ì •ì  íŒŒì¼ ì„œë¹™
        location /static/ {
            alias /var/www/static/;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# êµ¬í˜„ ìœ„ì¹˜: .env.production

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
POSTGRES_PASSWORD=your_secure_password_here
DATABASE_URL=postgresql://infoguard_user:your_secure_password_here@localhost:5432/infoguard

# Redis ì„¤ì •
REDIS_URL=redis://localhost:6379

# JWT ì„¤ì •
JWT_SECRET=your_jwt_secret_here

# API í‚¤
OPENAI_API_KEY=your_openai_api_key_here
YOUTUBE_API_KEY=your_youtube_api_key_here

# ì„œë²„ ì„¤ì •
NODE_ENV=production
PYTHON_ENV=production
PORT=3000
PYTHON_PORT=8000

# ë¡œê¹… ì„¤ì •
LOG_LEVEL=INFO
LOG_FILE=/var/log/infoguard/app.log

# ë³´ì•ˆ ì„¤ì •
CORS_ORIGINS=https://infoguard.example.com
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=100
```

## ğŸ“Š **ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…**

### 1. Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘
```yaml
# êµ¬í˜„ ìœ„ì¹˜: monitoring/prometheus.yml

global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'python-server'
    static_configs:
      - targets: ['python-server:8000']
    metrics_path: '/metrics'
    
  - job_name: 'nodejs-server'
    static_configs:
      - targets: ['nodejs-server:3000']
    metrics_path: '/metrics'
    
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']
    
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']
```

### 2. Grafana ëŒ€ì‹œë³´ë“œ
```json
{
  "dashboard": {
    "title": "Info-Guard ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§",
    "panels": [
      {
        "title": "API ì‘ë‹µ ì‹œê°„",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))"
          }
        ]
      },
      {
        "title": "ìš”ì²­ ìˆ˜",
        "type": "stat",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])"
          }
        ]
      }
    ]
  }
}
```

## ğŸ”’ **ë³´ì•ˆ ì„¤ì •**

### 1. ë°©í™”ë²½ ì„¤ì •
```bash
#!/bin/bash
# êµ¬í˜„ ìœ„ì¹˜: scripts/setup-firewall.sh

# UFW ë°©í™”ë²½ í™œì„±í™”
ufw --force enable

# ê¸°ë³¸ ì •ì±… ì„¤ì •
ufw default deny incoming
ufw default allow outgoing

# SSH ì ‘ì† í—ˆìš©
ufw allow ssh

# HTTP/HTTPS í¬íŠ¸ í—ˆìš©
ufw allow 80
ufw allow 443

# ë°ì´í„°ë² ì´ìŠ¤ í¬íŠ¸ëŠ” ë¡œì»¬ì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©
ufw allow from 127.0.0.1 to any port 5432
ufw allow from 127.0.0.1 to any port 6379

# ë°©í™”ë²½ ìƒíƒœ í™•ì¸
ufw status verbose
```

### 2. SSL ì¸ì¦ì„œ ìë™ ê°±ì‹ 
```bash
#!/bin/bash
# êµ¬í˜„ ìœ„ì¹˜: scripts/renew-ssl.sh

# Let's Encrypt ì¸ì¦ì„œ ê°±ì‹ 
certbot renew --quiet

# Nginx ì¬ì‹œì‘
docker-compose restart nginx

echo "SSL ì¸ì¦ì„œ ê°±ì‹  ì™„ë£Œ: $(date)"
```

## ğŸ¯ **êµ¬í˜„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [ ] Docker ì»¨í…Œì´ë„ˆí™”
- [ ] Docker Compose ì„¤ì •
- [ ] ê¸°ë³¸ CI/CD íŒŒì´í”„ë¼ì¸
- [ ] í™˜ê²½ë³„ ì„¤ì • íŒŒì¼

- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬
- [ ] ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•

- [ ] ìë™ ìŠ¤ì¼€ì¼ë§ ì„¤ì •
- [ ] ë°±ì—… ë° ë³µêµ¬ ì‹œìŠ¤í…œ
- [ ] ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì •
- [ ] CDN ì„¤ì •

